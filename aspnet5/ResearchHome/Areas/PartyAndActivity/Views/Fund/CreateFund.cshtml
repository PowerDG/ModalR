@{
    Layout = "~/Views/Shared/_Master.cshtml";
}

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model ResearchHome.Areas.PartyAndActivity.Models.FundModel
@addTagHelper *, ResearchHome


<style>
    .layui-form-checkbox i {
        border: 1px solid #d2d2d2;
    }
    
</style>
<div class="layui-row" style="margin-top:30px;margin-right:30px;">
    <div class="layui-col-xs12">
        <form class="layui-form"  asp-antiforgery="true" autocomplete="off" >
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">事项</label>
                <div class="layui-input-block">
                    <input type="text" name="Id" value="@Html.Raw(Model.Id)" style="display:none;">
                    <input type="text" name="ItemName" value="@Html.Raw(Model.ItemName)" class="layui-input" style="width:420px;" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <div class="layui-inline" style="float:left;">
                    <label class="layui-form-label">类型</label>
                    <div class="layui-input-inline" style="width:125px;">
                        @if (Model.OperatMoney >= 0)
                        {
                        <select name="type" id="select" lay-search>
                            <option selected disabled value="2">支出</option>
                        </select>
                        }
                        else if (Model.OperatMoney < 0)
                        {
                             <select name="type" id="select" lay-search>
                                 <option selected disabled value="3">入账</option>
                            </select>
                        }
                        else
                        {
                            <select name="type" id="select" lay-search>
                              <option selected value="1">请选择</option>
                              <option value="2">支出</option>
                              <option value="3">入账</option>
                            </select>
                        }
                        
                    </div>
                </div>
                <div class="layui-inline" style="float:left;margin-top:-1px;margin-left:-50px;">
                    <label class="layui-form-label">金额</label>
                    @if (Model.OperatMoney >= 0)
                    {
                        <input type="text" name="operatMoney" value="@Html.Raw(Model.OperatMoney)" class="layui-input" style="width:170px;" disabled>
                    }
                    else if (Model.OperatMoney < 0)
                    {
                        <input type="text" name="operatMoney" value="@Model.OperatMoney.ToString().Substring(1)" class="layui-input" style="width:170px;" disabled>
                    }
                    else
                    {
                        <input type="text" name="operatMoney" value="@Html.Raw(Model.OperatMoney)" class="layui-input" style="width:215px;" lay-verify="required|number">
                    }
                </div>

                </div>
                <div class="layui-form-item layui-form-text">
                    <label class="layui-form-label">备注</label>
                    <div class="layui-input-block">
                        <textarea name="description" id="description" placeholder="请输入备注" class="layui-textarea"  style="height:180px;width:420px;">@Html.Raw(Model.Description)</textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block" style="float:right;">
                        <button class="layui-btn" lay-submit lay-filter="go" >保存</button>
                    </div>
                </div>
        </form>
    </div>
</div>

<script>
    layui.use('form', function () {
        var form = layui.form;

        form.on('submit(go)', function (data) {
            if (data.field.ItemName.length > 24) {
                layer.msg("标题太长了哦！");
                return false;
            }
           
            if (!(data.field.operatMoney < 1000000 && data.field.operatMoney>=0)) {
                layer.msg("检查金额数目！！");
                return false;
            }
            if (data.field.type < 2) {
                layer.msg("请选择类型！");
                return false;
            } else if (data.field.type == 2) {
                data.field.operatMoney *= -1;
            }
            if (data.field.description.length > 200) {
                layer.msg("备注太长了哦！");
                return false;
            }
            var url = '/PartyAndActivity/Fund/CreateFund';
            $.ajax({
                type: 'POST',
                url: url,
                data: data.field,
                success: function (e) {
                    if (e.result) {
                        parent.layer.msg('添加成功！', { icon: 6, shift: -1, time: 1000, shade: 0.3 });
                    } else {
                        layer.msg("数据插入错误，请联系管理员！");
                    }
                },
                dataType: 'json'
            });
            parent.layer.closeAll();
            return false; 
        });

    })
</script>