@{
    Layout = "~/Views/Shared/_Master.cshtml";
}

@addTagHelper *, ResearchHome

@section Heads{
    <link href="/css/layerMaster.css" rel="stylesheet" />
    <link href="/css/TaskScheduleBoard/TaskSchedule/OptionsTask.css" rel="stylesheet" />
}
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model ResearchHome.Areas.TaskScheduleBoard.Models.TasksModel
@addTagHelper *, ResearchHome

@{ 
    var isReadOnly = !Model.IsLeaf;
}
<div class="layui-contentall" style="width: 100%;">
    <form id="optionTaskForm" class="layui-form layui-form-small" style="text-align:center;" asp-antiforgery="true" autocomplete="off">
        <input type="hidden" name="Id" asp-for="Id">
        <input type="hidden" name="IsLeaf" asp-for="IsLeaf">
        <div class="layui-form-item" style="height:120px;">
            <div class="layui-inline">
                <label class="layui-form-label">任务名</label>
                <div class="layui-input-inline">
                    <textarea name="Name" placeholder="请输入任务名" class="layui-textarea" asp-for="Name"></textarea>
                    <div>
                        <div class="valid-tips"><span class="valid-tips-span" asp-validation-for="Name"></span></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">分数</label>
                <div class="layui-input-inline" style="width:120px;">
                    <input type="text" name="Score" onblur="$('#ScoreError').css('display',isNaN($(this).val()) || parseInt($(this).val()) < 0 ? 'block' :'none');" asp-for="Score" placeholder="请输入分数" class="layui-input" readonly=@isReadOnly>
                    <div id="ScoreError" style="display:none;">
                        <div class="valid-tips">
                            <span class="valid-tips-span field-validation-error">
                                <span>请填写由数字组成的数(不能为负数)</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">负责人</label>
                <div class="layui-input-inline" style="width:120px;">
                    <select name="todoPerson" id="todoPerson" lay-search>
                        <option value="0"> 请选择</option>
                    </select>
                    <input type="hidden" name="MemberId" asp-for="MemberId">
                    <input type="hidden" name="MemberName" asp-for="MemberName">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">任务状态</label>
                <div class="layui-input-inline">
                    <select name="taskStatus" id="taskStatus" lay-filter="taskStatus" lay-search>
                        <option value="0"> 请选择</option>
                    </select>
                    <input type="hidden" name="Status" asp-for="Status">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">开始时间</label>
                <div class="layui-input-inline">
                    <input type="text" id="startTime" name="StartTime" asp-for="StartTime" placeholder="请选择开始时间" class="layui-input" onblur="onchangeEvent(this,'StartTimeError')">
                    <div id="StartTimeError" style="display:none;">
                        <div class="valid-tips">
                            <span class="valid-tips-span field-validation-error">
                                <span>请输入开始时间</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">结束时间</label>
                <div class="layui-input-inline">
                    <input type="text" id="endTime" name="EndTime" asp-for="EndTime" placeholder="请选择结束时间" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="height:120px;">
            <div class="layui-inline">
                <label class="layui-form-label">说明</label>
                <div class="layui-input-inline" style="width:350px;">
                    <textarea name="Description" placeholder="请输入内容" class="layui-textarea" asp-for="Description" style="min-height: 140px;"></textarea>
                    <div>
                        <div class="valid-tips"><span class="valid-tips-span" asp-validation-for="Description"></span></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="updateTaskDescription" class="layui-form-item" style="height:120px;display:none;">
            <div class="layui-inline">
                <label class="layui-form-label">修改说明</label>
                <div class="layui-input-inline" style="width:350px;">
                    <textarea name="UpdateDescription" placeholder="请输入修改备注" class="layui-textarea" asp-for="UpdateDescription"></textarea>
                    <div>
                        <div class="valid-tips"><span class="valid-tips-span" asp-validation-for="UpdateDescription"></span></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item layui-content-btn">
            <div class="layui-input-block">
                <button type="button" onclick="btnSubmit();" class="layui-btn" data-ripple>确认</button>
                <button type="button" onclick="parent.layer.closeAll();" class="layui-btn layui-btn-primary" data-ripple>关闭</button>
            </div>
        </div>
    </form>
</div>
@section Scripts{
    <script src="/js/TaskScheduleBoard/TaskSchedule/OptionsTask.js"></script>
    <script type="text/javascript">
        layui.use(["form", 'laydate'], function () {
            var form = layui.form;
            var laydate = layui.laydate;
            SelectBind("GetMembersList", "todoPerson", "Id", "Name", '@Html.Raw(Model.MemberId)', "150px", form);

            SelectBind("GetTaskStatus", "taskStatus", "StatusId", "StatusName", '@Html.Raw(Model.Status)', "150px", form);

            laydate.render({
                elem: '#startTime',
                type: 'datetime',
                //format:'yyyy/MM/dd HH:mm:ss',
                done: function (value, date, endDate) {
                    if (value == "") {
                        $('#StartTimeError').css("display", "block");
                    }
                    else {
                        $('#StartTimeError').css("display", "none");
                    }
                }
            });
            laydate.render({
                elem: '#endTime',
                type: 'datetime',
                done: function (value, date, endDate) {
                    if (value == "") {
                        $('#EndTimeError').css("display", "block");
                    }
                    else {
                        $('#EndTimeError').css("display", "none");
                    }
                }
            });
            form.on('select(taskStatus)', function (data) {
                if (data.value != '完成') {
                    $('#endTime').value = '';
                    $('#endTime').attr("disabled", true);
                }
                else {
                    $('#endTime').removeAttr("disabled");
                }
            });
            disabledEndTime();
        });
    </script>
}
